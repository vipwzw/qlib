# 时间范围新闻下载功能 - 使用指南

本指南介绍如何使用配置文件中的时间范围设置来自动下载新闻数据。

## ✨ 功能特性

### 🔧 配置文件驱动
- **自动读取**配置文件 `configs/config.yaml` 中 `evaluation.backtest` 部分的时间范围
- **智能过滤**只下载指定时间范围内的新闻数据
- **无需手动参数**时间范围由配置文件统一管理

### 📅 时间范围配置
在 `configs/config.yaml` 文件中设置：
```yaml
evaluation:
  backtest:
    start_date: "2025-06-13"      # 新闻数据开始日期
    end_date: "2025-07-07"        # 新闻数据结束日期
    # 其他回测配置...
```

---

## 🚀 使用方法

### 方式1：直接数据采集
```bash
# 根据配置文件时间范围下载新闻数据
python scripts/data_collection.py --data-type news
```

**输出示例：**
```
2025-07-08 20:22:53,413 - INFO - 📅 配置文件指定开始日期: 2025-06-13
2025-07-08 20:22:53,413 - INFO - 📅 配置文件指定结束日期: 2025-07-07
2025-07-08 20:23:56,766 - INFO - 时间范围过滤：3233 -> 3106 条新闻
```

### 方式2：自动数据管理器
```bash
# 使用自动数据管理器下载新闻
python scripts/auto_data_manager.py --download-news
```

**输出示例：**
```
2025-07-08 20:24:10,976 - INFO - 📅 配置的开始日期: 2025-06-13
2025-07-08 20:24:10,976 - INFO - 📅 配置的结束日期: 2025-07-07
2025-07-08 20:25:16,126 - INFO - ✅ 新闻数据下载完成
```

### 方式3：智能运行器
```bash
# 检查数据状态
python smart_run.py --check-data

# 一键运行完整流程（自动应用配置时间范围）
python smart_run.py
```

---

## 📊 数据处理流程

### 1. 配置读取
```
📖 读取 configs/config.yaml
  ↓
🔍 提取 evaluation.backtest.start_date
  ↓  
🔍 提取 evaluation.backtest.end_date
```

### 2. 新闻采集
```
🌐 从新闻源获取原始数据
  ↓
🔄 应用关键词过滤（加密货币相关）
  ↓
📅 应用时间范围过滤
  ↓
💾 保存最终数据
```

### 3. 时间过滤示例
- **原始新闻数据**：5000条
- **关键词过滤后**：3233条（只保留加密货币相关）
- **时间范围过滤后**：3106条（只保留2025-06-13到2025-07-07之间）

---

## ⚙️ 配置详解

### 时间格式
- **格式**：`YYYY-MM-DD`
- **示例**：`"2025-06-13"`
- **说明**：开始日期包含当天，结束日期包含当天

### 完整配置示例
```yaml
# configs/config.yaml
evaluation:
  backtest:
    start_date: "2025-06-13"      # 回测开始日期
    end_date: "2025-07-07"        # 回测结束日期
    initial_capital: 100000       # 初始资金
    transaction_cost: 0.001       # 交易成本
    # 其他策略参数...
```

---

## 🔍 验证数据

### 检查下载的新闻数据
```bash
# 查看新闻文件
ls -la data/raw/news/

# 检查数据格式
head -5 data/raw/news/crypto_news_*.csv
```

### 查看数据摘要
```bash
# 完整数据状态检查
python smart_run.py --data-summary
```

**输出示例：**
```
📋 数据可用性检查:
------------------------------
价格数据: ✅ 可用
新闻数据: ✅ 可用 (3106 条记录)
因子数据: ✅ 可用
```

---

## 💡 使用技巧

### 1. 修改时间范围
- 直接编辑 `configs/config.yaml` 文件
- 无需更改任何代码
- 所有工具自动识别新的时间范围

### 2. 数据一致性
- 价格数据、新闻数据、因子数据使用相同的时间范围
- 确保策略回测的数据一致性

### 3. 增量更新
- 如果修改了时间范围，重新运行下载即可
- 系统会根据新的时间范围重新过滤数据

---

## 🐛 故障排除

### 问题1：未读取到时间范围
**现象：** 日志中没有显示时间范围信息
**解决：** 检查 `configs/config.yaml` 文件中 `evaluation.backtest` 部分是否正确配置

### 问题2：过滤后新闻数量为0
**现象：** 时间范围过滤后没有新闻
**解决：** 
- 检查时间范围是否合理
- 确认新闻源是否有该时间段的数据
- 扩大时间范围重试

### 问题3：新闻数据检查失败
**现象：** 显示"新闻数据缺失"
**解决：** 
- 确认 `data/raw/news/` 目录下有 `.csv` 文件
- 检查文件是否包含必要列：`title`, `description`, `published`

---

## 📈 性能优化

### 新闻源配置
```yaml
news_sources:
  feixiaohao:
    max_pages: 50      # 调整页数以平衡数据量和下载时间
    per_page: 100      # 每页数据量
```

### 并发配置
```yaml
concurrency:
  max_workers: 4       # 并发数量
  timeout: 30          # 超时时间
```

---

## 🎯 最佳实践

1. **时间范围对齐**：确保价格数据和新闻数据的时间范围一致
2. **定期更新**：根据策略需要定期更新时间范围
3. **数据验证**：下载后使用 `--check-data` 验证数据完整性
4. **备份重要数据**：重要的新闻数据文件建议备份

通过配置文件统一管理时间范围，让新闻数据下载更加智能和一致！🎉 