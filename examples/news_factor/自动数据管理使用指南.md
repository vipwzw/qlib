# è‡ªåŠ¨æ•°æ®ç®¡ç†ç³»ç»Ÿ - ä½¿ç”¨æŒ‡å—

æœ¬æŒ‡å—ä»‹ç»æ–°é—»æƒ…æ„Ÿå› å­é¡¹ç›®çš„è‡ªåŠ¨æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œè®©æ‚¨æ— éœ€æ‰‹åŠ¨ç®¡ç†æ•°æ®æ–‡ä»¶ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ” æ™ºèƒ½æ•°æ®æ£€æµ‹
- **è‡ªåŠ¨æ£€æµ‹**ä»·æ ¼æ•°æ®ã€æ–°é—»æ•°æ®ã€å› å­æ•°æ®æ˜¯å¦å­˜åœ¨
- **æ—¶æ•ˆæ€§éªŒè¯**æ£€æŸ¥æ•°æ®æ˜¯å¦è¿‡æœŸéœ€è¦æ›´æ–°
- **å®Œæ•´æ€§æ ¡éªŒ**éªŒè¯æ•°æ®æ–‡ä»¶æ ¼å¼å’Œå¿…è¦å­—æ®µ

### ğŸ“¥ è‡ªåŠ¨æ•°æ®ä¸‹è½½
- **æŒ‰éœ€ä¸‹è½½**åªä¸‹è½½ç¼ºå¤±æˆ–è¿‡æœŸçš„æ•°æ®
- **æ™ºèƒ½é‡è¯•**ä¸‹è½½å¤±è´¥æ—¶çš„é”™è¯¯å¤„ç†
- **è¿›åº¦åé¦ˆ**è¯¦ç»†çš„ä¸‹è½½çŠ¶æ€æç¤º

### ğŸ”§ è‡ªåŠ¨å› å­ç”Ÿæˆ
- **ä¾èµ–æ£€æµ‹**å½“æºæ•°æ®æ›´æ–°æ—¶è‡ªåŠ¨é‡æ–°ç”Ÿæˆå› å­
- **å¤šæ ¼å¼æ”¯æŒ**æ”¯æŒCSVã€Parquetç­‰å¤šç§å­˜å‚¨æ ¼å¼
- **ç‰ˆæœ¬ç®¡ç†**è‡ªåŠ¨ä¸ºç”Ÿæˆçš„å› å­æ–‡ä»¶æ·»åŠ æ—¶é—´æˆ³

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šä½¿ç”¨æ™ºèƒ½è¿è¡Œå™¨ï¼ˆæ¨èï¼‰

```bash
# æœ€ç®€å•çš„ä½¿ç”¨æ–¹å¼ - ä¸€é”®è¿è¡Œ
python smart_run.py

# å¼ºåˆ¶é‡æ–°ä¸‹è½½æ‰€æœ‰æ•°æ®
python smart_run.py --force-download

# åªæ£€æŸ¥æ•°æ®çŠ¶æ€
python smart_run.py --check-data

# æŸ¥çœ‹æ•°æ®æ‘˜è¦
python smart_run.py --data-summary
```

### æ–¹å¼2ï¼šä½¿ç”¨æ”¹è¿›çš„å›æµ‹è„šæœ¬

```bash
# è‡ªåŠ¨æ£€æŸ¥æ•°æ®å¹¶è¿è¡Œå›æµ‹
python scripts/run_backtest.py

# å¼ºåˆ¶ä¸‹è½½æ•°æ®åè¿è¡Œå›æµ‹
python scripts/run_backtest.py --force-download

# ç¦ç”¨è‡ªåŠ¨æ•°æ®æ£€æŸ¥
python scripts/run_backtest.py --no-auto-data
```

### æ–¹å¼3ï¼šç‹¬ç«‹ä½¿ç”¨æ•°æ®ç®¡ç†å™¨

```bash
# åªæ£€æŸ¥æ•°æ®å¯ç”¨æ€§
python scripts/auto_data_manager.py --check

# å¼ºåˆ¶ä¸‹è½½ä»·æ ¼æ•°æ®
python scripts/auto_data_manager.py --download-price

# å¼ºåˆ¶ä¸‹è½½æ–°é—»æ•°æ®
python scripts/auto_data_manager.py --download-news

# å¼ºåˆ¶ç”Ÿæˆå› å­æ•°æ®
python scripts/auto_data_manager.py --generate-factors

# æŸ¥çœ‹å®Œæ•´æ•°æ®æ‘˜è¦
python scripts/auto_data_manager.py --summary

# æ¸…ç†7å¤©å‰çš„æ—§æ•°æ®
python scripts/auto_data_manager.py --clean 7
```

---

## ğŸ“‹ è¯¦ç»†åŠŸèƒ½è¯´æ˜

### 1. æ•°æ®æ£€æµ‹é€»è¾‘

#### ä»·æ ¼æ•°æ®æ£€æµ‹
- âœ… **æ–‡ä»¶å­˜åœ¨æ€§**ï¼šæ£€æŸ¥ `data/raw/price/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ•°æ®æ–‡ä»¶
- âœ… **æ—¶æ•ˆæ€§**ï¼šæ ¹æ®é…ç½®çš„ `lookback_days` éªŒè¯æ•°æ®æ˜¯å¦è¶³å¤Ÿæ–°
- âœ… **å®Œæ•´æ€§**ï¼šéªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¿…è¦çš„OHLCVå­—æ®µ

#### æ–°é—»æ•°æ®æ£€æµ‹
- âœ… **æ–‡ä»¶å­˜åœ¨æ€§**ï¼šæ£€æŸ¥ `data/raw/news/` ç›®å½•ä¸‹æ˜¯å¦æœ‰æ•°æ®æ–‡ä»¶
- âœ… **å†…å®¹å®Œæ•´æ€§**ï¼šéªŒè¯å¿…è¦å­—æ®µï¼š`title`, `content`, `timestamp`
- âœ… **æ•°æ®è´¨é‡**ï¼šæ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©ºæˆ–æŸå

#### å› å­æ•°æ®æ£€æµ‹
- âœ… **æ–‡ä»¶å­˜åœ¨æ€§**ï¼šæ£€æŸ¥ `data/factors/` ç›®å½•ä¸‹æ˜¯å¦æœ‰å› å­æ–‡ä»¶
- âœ… **å› å­å®Œæ•´æ€§**ï¼šéªŒè¯æ˜¯å¦åŒ…å«é¢„æœŸçš„åŸºç¡€å› å­
- âœ… **æ•°æ®æ›´æ–°æ€§**ï¼šå½“æºæ•°æ®æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨æ ‡è®°å› å­éœ€è¦é‡æ–°ç”Ÿæˆ

### 2. æ™ºèƒ½ä¸‹è½½ç­–ç•¥

```python
# ç³»ç»Ÿä¼šæŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§å¤„ç†æ•°æ®ï¼š

1. æ£€æŸ¥ä»·æ ¼æ•°æ®
   â”œâ”€â”€ å¦‚æœç¼ºå¤± â†’ ä¸‹è½½ä»·æ ¼æ•°æ®
   â””â”€â”€ å¦‚æœè¿‡æœŸ â†’ ä¸‹è½½æœ€æ–°æ•°æ®

2. æ£€æŸ¥æ–°é—»æ•°æ®  
   â”œâ”€â”€ å¦‚æœç¼ºå¤± â†’ ä¸‹è½½æ–°é—»æ•°æ®
   â””â”€â”€ å¦‚æœæŸå â†’ é‡æ–°ä¸‹è½½

3. æ£€æŸ¥å› å­æ•°æ®
   â”œâ”€â”€ å¦‚æœç¼ºå¤± â†’ ç”Ÿæˆå› å­æ•°æ®
   â”œâ”€â”€ å¦‚æœæºæ•°æ®æ›´æ–° â†’ é‡æ–°ç”Ÿæˆå› å­
   â””â”€â”€ å¦‚æœæ­£å¸¸ â†’ è·³è¿‡ç”Ÿæˆ
```

### 3. è‡ªåŠ¨é‡è¯•æœºåˆ¶

```yaml
# ä¸‹è½½å¤±è´¥æ—¶çš„å¤„ç†ç­–ç•¥ï¼š
retry_strategy:
  max_attempts: 3
  backoff_factor: 2
  timeout_handling: graceful_degradation
  fallback_options:
    - use_cached_data
    - use_mock_data  
    - prompt_manual_intervention
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### æ•°æ®è·¯å¾„é…ç½®
```yaml
# configs/config.yaml
data:
  price:
    data_dir: "data/raw/price"      # ä»·æ ¼æ•°æ®ç›®å½•
    lookback_days: 30               # æ•°æ®å›çœ‹å¤©æ•°
  news:
    data_dir: "data/raw/news"       # æ–°é—»æ•°æ®ç›®å½•
    processed_dir: "data/processed/news"  # å¤„ç†åæ•°æ®ç›®å½•
  factors:
    data_dir: "data/factors"        # å› å­æ•°æ®ç›®å½•
    save_format: "parquet"          # ä¿å­˜æ ¼å¼
```

### è‡ªåŠ¨æ£€æŸ¥é…ç½®
```yaml
# å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­æ§åˆ¶è‡ªåŠ¨æ£€æŸ¥è¡Œä¸º
auto_data_management:
  enabled: true                     # æ˜¯å¦å¯ç”¨è‡ªåŠ¨æ•°æ®ç®¡ç†
  check_on_startup: true           # å¯åŠ¨æ—¶æ˜¯å¦æ£€æŸ¥æ•°æ®
  auto_download: true              # æ˜¯å¦è‡ªåŠ¨ä¸‹è½½ç¼ºå¤±æ•°æ®
  max_data_age_days: 7             # æ•°æ®æœ€å¤§è¿‡æœŸå¤©æ•°
  cleanup_old_files: true          # æ˜¯å¦è‡ªåŠ¨æ¸…ç†æ—§æ–‡ä»¶
```

---

## ğŸ”§ é«˜çº§ç”¨æ³•

### 1. ç¼–ç¨‹æ–¹å¼è°ƒç”¨

```python
from scripts.auto_data_manager import AutoDataManager

# åˆå§‹åŒ–æ•°æ®ç®¡ç†å™¨
manager = AutoDataManager("configs/config.yaml")

# æ£€æŸ¥æ•°æ®çŠ¶æ€
availability = manager.check_data_availability()
print(f"ä»·æ ¼æ•°æ®: {availability['price_data']}")
print(f"æ–°é—»æ•°æ®: {availability['news_data']}")
print(f"å› å­æ•°æ®: {availability['factor_data']}")

# ç¡®ä¿æ•°æ®å‡†å¤‡å°±ç»ª
success = manager.ensure_data_ready()
if success:
    print("âœ… æ‰€æœ‰æ•°æ®å·²å‡†å¤‡å°±ç»ª")
    
# è·å–æ•°æ®æ‘˜è¦
summary = manager.get_data_summary()
for data_type, info in summary.items():
    print(f"{data_type}: {info}")
```

### 2. é›†æˆåˆ°è‡ªå®šä¹‰è„šæœ¬

```python
from scripts.auto_data_manager import AutoDataManager
from scripts.run_backtest import NewsSentimentBacktest

def my_analysis_pipeline():
    """è‡ªå®šä¹‰åˆ†ææµç¨‹"""
    
    # 1. ç¡®ä¿æ•°æ®å°±ç»ª
    data_manager = AutoDataManager()
    if not data_manager.ensure_data_ready():
        raise Exception("æ•°æ®å‡†å¤‡å¤±è´¥")
    
    # 2. è¿è¡Œç­–ç•¥ï¼ˆç¦ç”¨é‡å¤çš„æ•°æ®æ£€æŸ¥ï¼‰
    backtester = NewsSentimentBacktest(auto_data_check=False)
    results = backtester.run_simple_backtest()
    
    # 3. è‡ªå®šä¹‰åå¤„ç†
    # ... æ‚¨çš„åˆ†æä»£ç  ...
    
    return results
```

### 3. å®šæ—¶ä»»åŠ¡é›†æˆ

```bash
# æ·»åŠ åˆ° crontabï¼Œæ¯å¤©å‡Œæ™¨2ç‚¹æ›´æ–°æ•°æ®
0 2 * * * cd /path/to/qlib/examples/news_factor && python smart_run.py --force-download --no-save

# æ¯å°æ—¶æ£€æŸ¥ä¸€æ¬¡æ•°æ®å®Œæ•´æ€§  
0 * * * * cd /path/to/qlib/examples/news_factor && python scripts/auto_data_manager.py --check
```

---

## ğŸ“Š æ•°æ®ç®¡ç†å·¥å…·

### æ•°æ®çŠ¶æ€æ£€æŸ¥
```bash
# å¿«é€Ÿæ£€æŸ¥æ‰€æœ‰æ•°æ®çŠ¶æ€
python smart_run.py --check-data

# è¾“å‡ºç¤ºä¾‹ï¼š
# ğŸ“‹ æ•°æ®å¯ç”¨æ€§æ£€æŸ¥:
# ------------------------------
# ä»·æ ¼æ•°æ®: âœ… å¯ç”¨
# æ–°é—»æ•°æ®: âŒ ç¼ºå¤±  
# å› å­æ•°æ®: âœ… å¯ç”¨
```

### è¯¦ç»†æ•°æ®æ‘˜è¦
```bash
# æŸ¥çœ‹è¯¦ç»†æ•°æ®æ‘˜è¦
python smart_run.py --data-summary

# è¾“å‡ºç¤ºä¾‹ï¼š
# ğŸ“Š æ•°æ®æ‘˜è¦æŠ¥å‘Š:
# ==================================================
# 
# PRICE_DATA:
#   file_count: 2
#   latest_file: btc_usdt_1m_20240115_103000.csv
#   record_count: 43200
#   date_range: 2024-01-01 00:00:00 - 2024-01-15 10:30:00
#   columns: ['open', 'high', 'low', 'close', 'volume']
# 
# NEWS_DATA:
#   file_count: 1
#   latest_file: crypto_news_20240115_103000.csv  
#   record_count: 156
#   columns: ['title', 'content', 'timestamp', 'source']
# 
# FACTOR_DATA:
#   file_count: 1
#   latest_file: factors_20240115_103000.parquet
#   factor_count: 12
#   record_count: 43200
#   factors: ['sentiment_score_1m', 'sentiment_score_5m', ...]
```

### æ•°æ®æ¸…ç†
```bash
# æ¸…ç†7å¤©å‰çš„æ—§æ•°æ®æ–‡ä»¶
python smart_run.py --clean-data 7

# æ¸…ç†30å¤©å‰çš„æ—§æ•°æ®æ–‡ä»¶  
python scripts/auto_data_manager.py --clean 30
```

---

## ğŸš¨ é”™è¯¯å¤„ç†

### å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

#### 1. é…ç½®æ–‡ä»¶ä¸å­˜åœ¨
```
âŒ é”™è¯¯: é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: configs/config.yaml
```
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿é…ç½®æ–‡ä»¶å­˜åœ¨ï¼Œæˆ–ä½¿ç”¨ `--config` å‚æ•°æŒ‡å®šæ­£ç¡®è·¯å¾„

#### 2. APIå¯†é’¥æœªé…ç½®
```
âŒ é”™è¯¯: Binance APIå¯†é’¥æœªé…ç½®
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ `.env` æ–‡ä»¶ä¸­çš„APIé…ç½®ï¼Œå‚è€ƒé¡¹ç›®æ–‡æ¡£é…ç½®å¯†é’¥

#### 3. ç½‘ç»œè¿æ¥é—®é¢˜
```
âš ï¸ ä»·æ ¼æ•°æ®ä¸‹è½½å¤±è´¥ï¼Œå°†å°è¯•ä½¿ç”¨ç°æœ‰æ•°æ®
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–ç¨åé‡è¯•

#### 4. ç£ç›˜ç©ºé—´ä¸è¶³
```
âŒ å› å­æ•°æ®ç”Ÿæˆå¤±è´¥: [Errno 28] No space left on device
```
**è§£å†³æ–¹æ¡ˆ**: æ¸…ç†ç£ç›˜ç©ºé—´ï¼Œæˆ–ä½¿ç”¨ `--clean-data` æ¸…ç†æ—§æ•°æ®

---

## ğŸ“ ç›®å½•ç»“æ„

è‡ªåŠ¨æ•°æ®ç®¡ç†ç³»ç»Ÿç”Ÿæˆçš„æ–‡ä»¶ç»“æ„ï¼š

```
examples/news_factor/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/
â”‚   â”‚   â”œâ”€â”€ price/                  # åŸå§‹ä»·æ ¼æ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ btc_usdt_1m_20240115_103000.csv
â”‚   â”‚   â”‚   â””â”€â”€ btc_usdt_1m_20240116_120000.csv
â”‚   â”‚   â””â”€â”€ news/                   # åŸå§‹æ–°é—»æ•°æ®
â”‚   â”‚       â”œâ”€â”€ crypto_news_20240115_103000.csv
â”‚   â”‚       â””â”€â”€ crypto_news_20240116_120000.csv
â”‚   â”œâ”€â”€ processed/                  # å¤„ç†åçš„æ•°æ®
â”‚   â”œâ”€â”€ factors/                    # ç”Ÿæˆçš„å› å­æ•°æ®
â”‚   â”‚   â”œâ”€â”€ factors_20240115_103000.parquet
â”‚   â”‚   â””â”€â”€ factors_20240116_120000.parquet
â”‚   â””â”€â”€ results/                    # å›æµ‹ç»“æœ
â”‚       â”œâ”€â”€ backtest_results_20240115_103000.csv
â”‚       â””â”€â”€ performance_report_20240115_103000.html
â”œâ”€â”€ logs/                          # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ scripts/
    â”œâ”€â”€ auto_data_manager.py       # è‡ªåŠ¨æ•°æ®ç®¡ç†å™¨
    â”œâ”€â”€ run_backtest.py           # æ”¹è¿›çš„å›æµ‹è„šæœ¬
    â””â”€â”€ ...
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ—¥å¸¸ä½¿ç”¨å»ºè®®
- âœ… **é¦–æ¬¡è¿è¡Œ**ï¼šä½¿ç”¨ `python smart_run.py` è®©ç³»ç»Ÿè‡ªåŠ¨å¤„ç†ä¸€åˆ‡
- âœ… **å®šæœŸæ›´æ–°**ï¼šæ¯å¤©è¿è¡Œä¸€æ¬¡ `--force-download` è·å–æœ€æ–°æ•°æ®
- âœ… **ç›‘æ§çŠ¶æ€**ï¼šå®šæœŸä½¿ç”¨ `--check-data` æ£€æŸ¥æ•°æ®å®Œæ•´æ€§
- âœ… **æ¸…ç†ç»´æŠ¤**ï¼šæ¯å‘¨æ¸…ç†ä¸€æ¬¡æ—§æ•°æ®æ–‡ä»¶

### 2. æ€§èƒ½ä¼˜åŒ–
- ğŸš€ **å¹¶è¡Œä¸‹è½½**ï¼šç³»ç»Ÿæ”¯æŒå¤šæºå¹¶è¡Œä¸‹è½½
- ğŸš€ **å¢é‡æ›´æ–°**ï¼šåªä¸‹è½½ç¼ºå¤±æˆ–æ›´æ–°çš„æ•°æ®
- ğŸš€ **ç¼“å­˜æœºåˆ¶**ï¼šæ™ºèƒ½ç¼“å­˜é¿å…é‡å¤ä¸‹è½½
- ğŸš€ **æ ¼å¼ä¼˜åŒ–**ï¼šä½¿ç”¨Parquetæ ¼å¼æå‡è¯»å†™é€Ÿåº¦

### 3. é”™è¯¯æ¢å¤
- ğŸ›¡ï¸ **ä¼˜é›…é™çº§**ï¼šä¸‹è½½å¤±è´¥æ—¶å°è¯•ä½¿ç”¨ç°æœ‰æ•°æ®
- ğŸ›¡ï¸ **è‡ªåŠ¨é‡è¯•**ï¼šç½‘ç»œé—®é¢˜æ—¶è‡ªåŠ¨é‡è¯•ä¸‹è½½
- ğŸ›¡ï¸ **æ•°æ®éªŒè¯**ï¼šåŠ è½½å‰éªŒè¯æ•°æ®å®Œæ•´æ€§
- ğŸ›¡ï¸ **å¤‡ä»½æœºåˆ¶**ï¼šä¿ç•™å¤šç‰ˆæœ¬æ•°æ®æ–‡ä»¶

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é¡¹ç›®ä½¿ç”¨æŒ‡å—](é¡¹ç›®ä½¿ç”¨æŒ‡å—.md) - åŸºç¡€ä½¿ç”¨æ•™ç¨‹
- [é…ç½®æ–‡ä»¶è¯´æ˜](configs/config.yaml) - è¯¦ç»†é…ç½®é€‰é¡¹
- [APIæ–‡æ¡£](scripts/) - å„æ¨¡å—APIè¯´æ˜
- [å¸¸è§é—®é¢˜](README.md#å¸¸è§é—®é¢˜) - FAQå’Œæ•…éšœæ’é™¤

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è‡ªåŠ¨æ•°æ®ç®¡ç†ç³»ç»Ÿæ—¶é‡åˆ°é—®é¢˜ï¼š

1. **æ£€æŸ¥æ—¥å¿—**ï¼šæŸ¥çœ‹ `logs/` ç›®å½•ä¸‹çš„è¯¦ç»†æ—¥å¿—
2. **éªŒè¯é…ç½®**ï¼šç¡®è®¤ `configs/config.yaml` å’Œ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®
3. **é‡æ–°åˆå§‹åŒ–**ï¼šå°è¯•ä½¿ç”¨ `--force-download` å¼ºåˆ¶é‡æ–°ä¸‹è½½
4. **æ‰‹åŠ¨å¹²é¢„**ï¼šå¿…è¦æ—¶å¯ä»¥ç¦ç”¨è‡ªåŠ¨ç®¡ç†ä½¿ç”¨ `--no-auto-data`

é€šè¿‡è¿™ä¸ªè‡ªåŠ¨æ•°æ®ç®¡ç†ç³»ç»Ÿï¼Œæ‚¨å¯ä»¥ä¸“æ³¨äºç­–ç•¥å¼€å‘ï¼Œè€Œæ— éœ€æ‹…å¿ƒæ•°æ®ç®¡ç†çš„å¤æ‚æ€§ï¼ ğŸ‰ 